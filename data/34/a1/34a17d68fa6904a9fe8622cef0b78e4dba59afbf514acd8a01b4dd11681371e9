{"url":"https://api.github.com/repos/bio-guoda/preston/issues/69","repository_url":"https://api.github.com/repos/bio-guoda/preston","labels_url":"https://api.github.com/repos/bio-guoda/preston/issues/69/labels{/name}","comments_url":"https://api.github.com/repos/bio-guoda/preston/issues/69/comments","events_url":"https://api.github.com/repos/bio-guoda/preston/issues/69/events","html_url":"https://github.com/bio-guoda/preston/pull/69","id":656808976,"node_id":"MDExOlB1bGxSZXF1ZXN0NDQ5MDM5Njc1","number":69,"title":"Search indexing","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-07-14T18:23:43Z","updated_at":"2020-09-04T18:51:17Z","closed_at":"2020-09-04T18:49:50Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"pull_request":{"url":"https://api.github.com/repos/bio-guoda/preston/pulls/69","html_url":"https://github.com/bio-guoda/preston/pull/69","diff_url":"https://github.com/bio-guoda/preston/pull/69.diff","patch_url":"https://github.com/bio-guoda/preston/pull/69.patch","merged_at":null},"body":"Added a CmdSimilar to discover similar contents. The *maximum number of similar matches for each content* and the *minimum similarity score threshold for a similar match to be recorded* are configurable.\r\n\r\ne.g. `preston ls | preston similar --hits=10, --threshold=100`\r\n\r\nA recorded similarity match currently looks like this (and I fully expect this to be changed):\r\n```\r\n<0b1be6f7-cb1b-4ec1-bf92-50da0518a4c9> <http://www.w3.org/ns/prov#value> \"41.0\"^^<http://www.w3.org/2001/XMLSchema#float> .\r\n<0b1be6f7-cb1b-4ec1-bf92-50da0518a4c9> <http://www.w3.org/ns/prov#qualifiedGeneration> <19df8c55-d33d-4a03-9135-7895f0212b24> .\r\n<19df8c55-d33d-4a03-9135-7895f0212b24> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> .\r\n<19df8c55-d33d-4a03-9135-7895f0212b24> <http://www.w3.org/ns/prov#used> <hash://sha256/1aa34112ade084ccc8707388fbc329dcb8fae5f895cb266e3ad943f7495740b3> .\r\n```\r\n\r\nNote that currently, for two TLSH hashes A and B, \"similarity\" is currently calculated as the number of bins that have the same value in both A and B. Since there are 134 bins in a TLSH hash, the maximum similarity score is 134. It might be more intuitive if we normalize it to [0, 1]. The TLSH paper describes a more complicated distance algorithm that considers the difference between bin values, not just exact matches. It might be helpful for us to do the same.\r\n\r\nOn the preston-amazon observatory, two random contents had a similarity of 41:\r\n```\r\n$ preston ls | grep wasDerivedFrom | head -n2 | preston similar --thresh=0\r\n<https://preston.guoda.bio> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#SoftwareAgent> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<https://preston.guoda.bio> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Agent> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<https://preston.guoda.bio> <http://purl.org/dc/terms/description> \"Preston is a software program that finds, archives and provides access to biodiversity datasets.\"@en <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<44702fd6-4531-4fe9-9e61-5715266de952> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<44702fd6-4531-4fe9-9e61-5715266de952> <http://purl.org/dc/terms/description> \"An event that generates similarity values between encountered contents (e.g., hash://sha256/... identifiers) that have been associated with a similarity hash (e.g., hash://tika-tlsh/...). The process currently uses similarity hashes (e.g., Trend Micro Locality Sensitive Hash, https://github.com/trendmicro/tlsh/blob/master/TLSH_CTC_final.pdf) calculated on content text extracted using https://tika.apache.org.\"@en <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<44702fd6-4531-4fe9-9e61-5715266de952> <http://www.w3.org/ns/prov#startedAtTime> \"2020-07-14T17:48:45.145Z\"^^<http://www.w3.org/2001/XMLSchema#dateTime> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<44702fd6-4531-4fe9-9e61-5715266de952> <http://www.w3.org/ns/prov#wasStartedBy> <https://preston.guoda.bio> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<https://doi.org/10.5281/zenodo.1410543> <http://www.w3.org/ns/prov#usedBy> <44702fd6-4531-4fe9-9e61-5715266de952> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<https://doi.org/10.5281/zenodo.1410543> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.org/dc/dcmitype/Software> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<https://doi.org/10.5281/zenodo.1410543> <http://purl.org/dc/terms/bibliographicCitation> \"Jorrit Poelen, Icaro Alzuru, & Michael Elliott. 2019. Preston: a biodiversity dataset tracker (Version 0.0.1-SNAPSHOT) [Software]. Zenodo. http://doi.org/10.5281/zenodo.1410543\"@en <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<0659a54f-b713-4f86-a917-5be166a14110> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Entity> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<0659a54f-b713-4f86-a917-5be166a14110> <http://purl.org/dc/terms/description> \"A biodiversity dataset graph archive.\"@en <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<hash://sha256/c2faaeac7467d99f6567f4f72a5370ea77c7829524f39e2603df7ae6f657d7ba> <http://www.w3.org/ns/prov#usedBy> <44702fd6-4531-4fe9-9e61-5715266de952> <44702fd6-4531-4fe9-9e61-5715266de952> .\r\n<hash://tika-tlsh/253af515a4ff1c20add297ab08925df37d2ff42e9d048d8e20c72f1609477a96385> <http://www.w3.org/ns/prov#wasDerivedFrom> <hash://sha256/1aa34112ade084ccc8707388fbc329dcb8fae5f895cb266e3ad943f7495740b3> <aa08b5cb-78c3-46f5-81b3-e8726cc1e2f5> .\r\n<hash://tika-tlsh/282ee27a09f35136a5b950bfe468747e3f258f6e5ca14094940f9914ce30b7371ca> <http://www.w3.org/ns/prov#wasDerivedFrom> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <51ccff27-dc62-4123-8a26-7491b9a644fe> .\r\n<7256130b-23ef-4b20-9f5c-fb837e18cc89> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <7256130b-23ef-4b20-9f5c-fb837e18cc89> .\r\n<7256130b-23ef-4b20-9f5c-fb837e18cc89> <http://www.w3.org/ns/prov#wasInformedBy> <51ccff27-dc62-4123-8a26-7491b9a644fe> <7256130b-23ef-4b20-9f5c-fb837e18cc89> .\r\n<0b1be6f7-cb1b-4ec1-bf92-50da0518a4c9> <http://www.w3.org/ns/prov#value> \"41.0\"^^<http://www.w3.org/2001/XMLSchema#float> <7256130b-23ef-4b20-9f5c-fb837e18cc89> .\r\n<0b1be6f7-cb1b-4ec1-bf92-50da0518a4c9> <http://www.w3.org/ns/prov#qualifiedGeneration> <19df8c55-d33d-4a03-9135-7895f0212b24> <7256130b-23ef-4b20-9f5c-fb837e18cc89> .\r\n<19df8c55-d33d-4a03-9135-7895f0212b24> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <7256130b-23ef-4b20-9f5c-fb837e18cc89> .\r\n<19df8c55-d33d-4a03-9135-7895f0212b24> <http://www.w3.org/ns/prov#used> <hash://sha256/1aa34112ade084ccc8707388fbc329dcb8fae5f895cb266e3ad943f7495740b3> <7256130b-23ef-4b20-9f5c-fb837e18cc89> .\r\n```\r\n\r\nRunning on the full preston-amazon observatory (default 100 max hits, 100 similarity score threshold) found 17,517 similar content pairs across 1,438 unique contents, and took 3m42s to run:\r\n```\r\n$ time preston ls | preston similar > out\r\nreal    3m42.092s\r\nuser    0m56.188s\r\nsys     1m6.141s\r\n$ cat out | grep \"#wasDerivedFrom\" | wc -l\r\n1438\r\n$ cat out | grep \"#value\" | wc -l\r\n17517\r\n```\r\n\r\nThe distribution of similarity scores:\r\n```\r\n$ cat out-similar | grep \"#value\" | cut -c75- | cut -c-3 | sort | uniq -c | sort -nr -k2\r\n     45 134\r\n     45 132\r\n     80 131\r\n     80 130\r\n    160 129\r\n    194 128\r\n    160 127\r\n    338 126\r\n     80 125\r\n    374 124\r\n    214 123\r\n     80 122\r\n     90 121\r\n   2251 120\r\n    408 119\r\n   5363 118\r\n    178 117\r\n    134 113\r\n    269 108\r\n    159 106\r\n    447 103\r\n    284 102\r\n    159 101\r\n    667 100\r\n    125 99.\r\n     96 98.\r\n    282 97.\r\n    150 96.\r\n    128 95.\r\n    395 94.\r\n    162 93.\r\n    141 92.\r\n    168 91.\r\n    158 90.\r\n    223 89.\r\n    178 88.\r\n     62 87.\r\n     82 86.\r\n     25 85.\r\n     70 84.\r\n    102 83.\r\n    141 82.\r\n     24 81.\r\n      3 80.\r\n     61 79.\r\n     27 78.\r\n     27 77.\r\n     55 76.\r\n     49 75.\r\n    117 73.\r\n      3 72.\r\n     24 71.\r\n     36 70.\r\n     21 69.\r\n     38 67.\r\n     62 66.\r\n     17 65.\r\n    105 64.\r\n    102 63.\r\n     89 62.\r\n    126 61.\r\n    129 60.\r\n    105 59.\r\n     50 58.\r\n     37 57.\r\n    133 56.\r\n     97 55.\r\n     47 54.\r\n    114 53.\r\n     66 52.\r\n     96 51.\r\n     43 50.\r\n    114 49.\r\n    111 48.\r\n    105 47.\r\n      1 46.\r\n    120 45.\r\n      6 44.\r\n     27 43.\r\n     48 42.\r\n     42 41.\r\n      9 40.\r\n      9 39.\r\n     36 38.\r\n     21 37.\r\n     18 33.\r\n```","closed_by":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/69/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bio-guoda/preston/issues/69/timeline","performed_via_github_app":null,"state_reason":null}