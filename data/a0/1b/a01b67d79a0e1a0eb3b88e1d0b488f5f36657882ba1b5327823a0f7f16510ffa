[{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/638370927","html_url":"https://github.com/bio-guoda/preston/issues/62#issuecomment-638370927","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/62","id":638370927,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODM3MDkyNw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-03T18:11:55Z","updated_at":"2020-06-03T21:20:33Z","body":"@faroit hey Fabian-Robert - \r\n\r\nThanks for your message and questions. I much enjoyed learning about your use case. \r\n\r\nGiven the importance of being able to reliably reference data associated with impressive amount of data GBIF produces, I've decided to prepare an elaborate response, so please bear with me ; )\r\n\r\nCurrently, GBIF download DOI URLs (or GBIF *query* DOI URLs) like https://doi.org/10.15468/dl.4n9w6m resolve to html pages suited for human consumption. \r\n\r\nSo, when running Preston using:\r\n\r\n```preston update https://doi.org/10.15468/dl.4n9w6m```, you'd see Preston provenance logging ending with:\r\n\r\n```\r\n<https://doi.org/10.15468/dl.4n9w6m> <http://purl.org/pav/hasVersion> <hash://sha256/fe5f69be7ce83b32faeea9a3c275641b1c59dbbce2af57f43ce78d743ebf3e2c> <3ae675f4-e228-47e0-98e9-52a1d784ee15> .\r\n```\r\n\r\nThen, look at what the resolved content with content id ```hash://sha256/fe5f69be7ce83b32faeea9a3c275641b1c59dbbce2af57f43ce78d743ebf3e2c``` using:\r\n\r\n```\r\n$ preston cat hash://sha256/fe5f69be7ce83b32faeea9a3c275641b1c59dbbce2af57f43ce78d743ebf3e2c | head\r\n\r\n<!DOCTYPE html>\r\n\r\n<!--[if !IE]> -->\r\n<html lang=\"en\" class=\"not_ie\" ng-app=\"portal\"  >\r\n<!-- <![endif]-->\r\n<!--[if IE]>\r\n<html lang=\"en\" class=\"ie\" ng-app=\"portal\">\r\n<![endif]-->\r\n```\r\nThis shows that the queried DOI URL resolves to a (human readable) html page. This page is not designed for programs to ingest and link to related (meta-) datasets. This is perhaps a silly example, but shows that DOIs are typically not designed to help establish reproducible data workflows. \r\n\r\nHowever, if you'd like, we can think about adding support to Preston and help connect GBIF query DOIs to a download archive that is associated to it by implementing something like:\r\n\r\nStep 1. if Preston sees a doi url with that contains \"10.15468/\" (GBIF's organization DOI registration code), redirect to the associated, machine-readable, GBIF APIs endpoints. In this case, they would be  https://api.gbif.org/v1/occurrence/download/0062961-200221144449610 .\r\n\r\nStep 2. resolve content of GBIF api to associated json\r\n\r\n```json\r\n{\r\n  \"key\": \"0062961-200221144449610\",\r\n  \"doi\": \"10.15468/dl.4n9w6m\",\r\n  \"license\": \"http://creativecommons.org/licenses/by-nc/4.0/legalcode\",\r\n  \"request\": {\r\n    \"predicate\": {\r\n      \"type\": \"equals\",\r\n      \"key\": \"TAXON_KEY\",\r\n      \"value\": \"4167110\"\r\n    },\r\n    \"sendNotification\": true,\r\n    \"format\": \"DWCA\"\r\n  },\r\n  \"created\": \"2020-05-14T08:24:00.109+0000\",\r\n  \"modified\": \"2020-05-14T08:24:55.864+0000\",\r\n  \"eraseAfter\": \"2020-11-14T08:24:00.044+0000\",\r\n  \"status\": \"SUCCEEDED\",\r\n  \"downloadLink\": \"http://api.gbif.org/v1/occurrence/download/request/0062961-200221144449610.zip\",\r\n  \"size\": 33353,\r\n  \"totalRecords\": 39,\r\n  \"numberDatasets\": 8\r\n}\r\n```\r\n\r\nStep 3. Preston recognizes the ```downloadLink``` and resolves dwca URL http://api.gbif.org/v1/occurrence/download/request/0062961-200221144449610.zip . \r\n\r\nStep 4. Preston download the dwca, calculates the content id (or hash) and reports on using:\r\n\r\n```\r\n<http://api.gbif.org/v1/occurrence/download/request/0062961-200221144449610.zip> <http://purl.org/pav/hasVersion> <hash://sha256/f0e8a3df97c04c1de91bb610706a2d62e42e4d1d19a0f4e22fe5e20375926d46> <510e6566-8451-4e6f-8881-989efb6dd600> .\r\n```\r\n\r\nStep 5. Now, the GBIF download archive can be reliably referenced and resolved using their content id :\r\n\r\n```\r\n$ preston cat hash://sha256/f0e8a3df97c04c1de91bb610706a2d62e42e4d1d19a0f4e22fe5e20375926d46 > dwca.zip\r\n$ unzip -l dwca.zip \r\nArchive:  dwca.zip\r\n  Length      Date    Time    Name\r\n---------  ---------- -----   ----\r\n    44180  2020-05-14 08:24   occurrence.txt\r\n    29876  2020-05-14 08:24   verbatim.txt\r\n     3259  2020-05-14 08:24   multimedia.txt\r\n     1682  2020-05-14 08:24   citations.txt\r\n    15212  2020-05-14 08:24   dataset/821cc27a-e3bb-4bc5-ac34-89ada245069d.xml\r\n     1716  2020-05-14 08:24   dataset/c1aaedc7-b5ba-4baf-9112-ec70637e242e.xml\r\n     4305  2020-05-14 08:24   dataset/040c5662-da76-4782-a48e-cdea1892d14c.xml\r\n     5295  2020-05-14 08:24   dataset/b5cdf794-8fa4-4a85-8b26-755d087bf531.xml\r\n     3157  2020-05-14 08:24   dataset/cd6e21c8-9e8a-493a-8a76-fbf7862069e5.xml\r\n     2167  2020-05-14 08:24   dataset/7adf20e0-c955-11de-95c0-b8a03c50a862.xml\r\n     5748  2020-05-14 08:24   dataset/15f819bd-6612-4447-854b-14d12ee1022d.xml\r\n     3039  2020-05-14 08:24   dataset/bf2a4bf0-5f31-11de-b67e-b8a03c50a862.xml\r\n     1108  2020-05-14 08:24   rights.txt\r\n     3047  2020-05-14 08:24   metadata.xml\r\n    36147  2020-05-14 08:24   meta.xml\r\n---------                     -------\r\n   159938                     15 files\r\n```\r\n\r\nWith this (minor) added functionality, Preston has (indirectly) associated the GBIF Query DOI with some associated DwC-A archive served by GBIF as some time.\r\n\r\nSimilar functionality can be added to document image urls and their associated content found in DwC-A.\r\n \r\nThanks again for sharing your use case and I am curious to hear your thoughts about the proposed Preston feature(s). \r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/638370927/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/638374064","html_url":"https://github.com/bio-guoda/preston/issues/62#issuecomment-638374064","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/62","id":638374064,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODM3NDA2NA==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-03T18:17:34Z","updated_at":"2020-06-03T18:17:34Z","body":"Please note that Preston already has functionality to track the source archives associated with GBIF registered datasets. See https://github.com/bio-guoda/preston-amazon/ for an example.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/638374064/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/638453945","html_url":"https://github.com/bio-guoda/preston/issues/62#issuecomment-638453945","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/62","id":638453945,"node_id":"MDEyOklzc3VlQ29tbWVudDYzODQ1Mzk0NQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-03T20:49:53Z","updated_at":"2020-06-03T20:49:53Z","body":"@faroit I couldn't resist to implement a first at supporting some of the use case you proposed (see #63 ).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/638453945/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/902319192","html_url":"https://github.com/bio-guoda/preston/issues/62#issuecomment-902319192","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/62","id":902319192,"node_id":"IC_kwDOCMmefs41yExY","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-19T23:31:13Z","updated_at":"2021-08-19T23:31:13Z","body":"#63 provides an example for verifying / tracking content associated with GBIF DOI. \r\n\r\nPlease feel free to re-open / comment if there's any additional thoughts on the topic.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/902319192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]