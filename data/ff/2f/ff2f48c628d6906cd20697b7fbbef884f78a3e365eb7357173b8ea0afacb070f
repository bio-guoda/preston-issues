[{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098520264","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1098520264","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1098520264,"node_id":"IC_kwDOCMmefs5BehbI","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-13T21:49:43Z","updated_at":"2022-04-13T21:49:43Z","body":"Note that the content is associated with https://doi.org/10.15468/17e8en https://www.gbif.org/dataset/62d82928-dc6f-40dc-85b3-f2be47e7b49a and  Creuwels J (2017). Naturalis Biodiversity Center (NL) - Museum collection digitized at storage unit level. Naturalis Biodiversity Center. Occurrence dataset https://doi.org/10.15468/17e8en accessed via GBIF.org on 2022-04-13. \r\n\r\nfor some reason, the original source is no longer available. https://drive.google.com/uc?export=download&id=0B-BbRNUB6S7aSVdYSjNpbkZsM1E","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098520264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098528673","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1098528673","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1098528673,"node_id":"IC_kwDOCMmefs5Bejeh","user":{"login":"mdoering","id":327505,"node_id":"MDQ6VXNlcjMyNzUwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/327505?v=4","gravatar_id":"","url":"https://api.github.com/users/mdoering","html_url":"https://github.com/mdoering","followers_url":"https://api.github.com/users/mdoering/followers","following_url":"https://api.github.com/users/mdoering/following{/other_user}","gists_url":"https://api.github.com/users/mdoering/gists{/gist_id}","starred_url":"https://api.github.com/users/mdoering/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdoering/subscriptions","organizations_url":"https://api.github.com/users/mdoering/orgs","repos_url":"https://api.github.com/users/mdoering/repos","events_url":"https://api.github.com/users/mdoering/events{/privacy}","received_events_url":"https://api.github.com/users/mdoering/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-13T22:03:40Z","updated_at":"2022-04-13T22:03:40Z","body":"I think these entities are not part of the basic xml specs. It does work fine with the COL DwcaReader libraries though which uses the stax2 library to read the xml which does the unescaping. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098528673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098539875","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1098539875","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1098539875,"node_id":"IC_kwDOCMmefs5BemNj","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-13T22:23:56Z","updated_at":"2022-04-13T22:23:56Z","body":"@mdoering thanks for your reply. Does this mean that you are no longer using the gbif-dwca-io lib? What is the relation between the COL DwcaReader and the GBIF DwcaReader? ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098539875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098845654","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1098845654","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1098845654,"node_id":"IC_kwDOCMmefs5Bfw3W","user":{"login":"mdoering","id":327505,"node_id":"MDQ6VXNlcjMyNzUwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/327505?v=4","gravatar_id":"","url":"https://api.github.com/users/mdoering","html_url":"https://github.com/mdoering","followers_url":"https://api.github.com/users/mdoering/followers","following_url":"https://api.github.com/users/mdoering/following{/other_user}","gists_url":"https://api.github.com/users/mdoering/gists{/gist_id}","starred_url":"https://api.github.com/users/mdoering/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdoering/subscriptions","organizations_url":"https://api.github.com/users/mdoering/orgs","repos_url":"https://api.github.com/users/mdoering/repos","events_url":"https://api.github.com/users/mdoering/events{/privacy}","received_events_url":"https://api.github.com/users/mdoering/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T08:26:24Z","updated_at":"2022-04-14T08:27:01Z","body":"They are separate [implementations](https://github.com/CatalogueOfLife/backend/blob/master/webservice/src/main/java/life/catalogue/importer/dwca/DwcaReader.java) both building on the [dwc-api](https://github.com/gbif/dwc-api) that defines the terms. The COL version uses the univocity csv parser under the hood and shares most logic and [code](https://github.com/CatalogueOfLife/backend/tree/master/webservice/src/main/java/life/catalogue/csv) with other tab file oriented readers like [ColDP](https://github.com/CatalogueOfLife/backend/blob/master/webservice/src/main/java/life/catalogue/importer/coldp/ColdpReader.java) and [ACEF](https://github.com/CatalogueOfLife/backend/blob/master/webservice/src/main/java/life/catalogue/importer/acef/AcefReader.java). That wasn't possible with the existing dwca-io which is build around the [star schema](https://github.com/gbif/dwca-io/blob/master/src/main/java/org/gbif/dwc/record/StarRecord.java). Not requiring gbif-common was also desirable.\r\n\r\nIf useful we could extract the various csv parsers into a lean module that allows reuse.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098845654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098941644","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1098941644","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1098941644,"node_id":"IC_kwDOCMmefs5BgITM","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T09:41:32Z","updated_at":"2022-04-14T09:41:32Z","body":"@mdoering Thanks for the pointers! Yes, I much like your idea to create a lean module. \r\n\r\nAssuming that it'll take a while to create such a module, would you advise to use my own COL inspired version to avoid this reported issue?\r\n\r\nAlso, what code base is used for GBIF dataset indexing today? Or, what is today's use of dwca-io in the GBIF universe?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098941644/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098971931","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1098971931","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1098971931,"node_id":"IC_kwDOCMmefs5BgPsb","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T10:02:20Z","updated_at":"2022-04-14T10:02:20Z","body":"BTW - just to give you an idea of how Preston implements the DwC-A json streamer on top of dwca-io , see - \r\n\r\nhttps://github.com/bio-guoda/preston/blob/4bb0a0037fd055d34b111067cca6c3ceed356e2f/preston-dwc/src/main/java/org/gbif/dwc/DwCArchiveStreamHandler.java\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1098971931/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1099087646","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1099087646","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1099087646,"node_id":"IC_kwDOCMmefs5Bgr8e","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T11:24:40Z","updated_at":"2022-04-14T11:24:40Z","body":"@mdoering after implementing a unit test to reproduce the issue of the  \"&#x9; and &#xA; be used instead of \\t and \\n in meta.xml row definitions, I found that these values were parsed ok, but ignored, because of a suspected bug in https://github.com/gbif/dwca-io/blob/7cd05e21ebbc0dece62c9e73be41e2e898959073/src/main/java/org/gbif/dwc/meta/MetaXMLSaxHandler.java#L82 \r\n\r\nand \r\n\r\nhttps://github.com/gbif/dwca-io/blob/7cd05e21ebbc0dece62c9e73be41e2e898959073/src/main/java/org/gbif/dwc/meta/MetaXMLSaxHandler.java#L92\r\n\r\nthe getAttr method uses StringUtils.isBlank and this filters out the encoded control characters like ```\\t``` and ```\\n```. I've added a patched version in my own code base via https://github.com/bio-guoda/preston/commit/c5bbc6ec328c63af7fe990be44b991d5488bd3a1\r\n\r\nAre you still maintaining/ using dwca-io ? If so, how would you like to proceed in fixing this issue.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1099087646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1099162452","html_url":"https://github.com/bio-guoda/preston/issues/161#issuecomment-1099162452","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/161","id":1099162452,"node_id":"IC_kwDOCMmefs5Bg-NU","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T13:02:13Z","updated_at":"2022-04-14T13:02:13Z","body":"Root cause appeared to be a bug in the gbif dwca-io lib. \r\n\r\nAfter patch, the following result was found:\r\n\r\n```\r\n# get content\r\n$ preston cat --remote https://deeplinker.bio hash://sha256/d47fa5353f0a5a78ac0eb74db37f89f1ac255b8065f75bc35bc124c62047035c > funky.zip\r\n# track content\r\n$ preston track file://$PWD/funky.zip\r\n...\r\n# print first json record\r\n$ preston ls | grep funky | preston dwc-stream | head -n1 | jq .\r\n```\r\n\r\nand the following output was produced:\r\n\r\n```json\r\n{\r\n  \"http://www.w3.org/ns/prov#wasDerivedFrom\": \"line:zip:hash://sha256/d47fa5353f0a5a78ac0eb74db37f89f1ac255b8065f75bc35bc124c62047035c!/occurrence.txt!/L2\",\r\n  \"http://www.w3.org/1999/02/22-rdf-syntax-ns#type\": \"http://rs.tdwg.org/dwc/terms/Occurrence\",\r\n  \"http://rs.tdwg.org/dwc/terms/genus\": \"Apodemus\",\r\n  \"http://rs.tdwg.org/dwc/terms/recordedBy\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/continent\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/sex\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/basisOfRecord\": \"StorageUnit\",\r\n  \"http://rs.tdwg.org/dwc/terms/scientificName\": \"Apodemus sylvaticus Linnaeus, 1758\",\r\n  \"http://rs.tdwg.org/dwc/terms/preparations\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/infraspecificEpithet\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/individualCount\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/eventDate\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/institutionCode\": \"Naturalis\",\r\n  \"http://rs.tdwg.org/dwc/terms/verbatimEventDate\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/locality\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/catalogNumber\": \"BE.0000001\",\r\n  \"http://rs.tdwg.org/dwc/terms/stateProvince\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/family\": \"Muridae\",\r\n  \"http://rs.tdwg.org/dwc/terms/lifeStage\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/subgenus\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/typeStatus\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/collectionCode\": \"Mammalia\",\r\n  \"http://rs.tdwg.org/dwc/terms/kingdom\": \"Animalia\",\r\n  \"http://rs.tdwg.org/dwc/terms/scientificNameAuthorship\": \"Linnaeus, 1758\",\r\n  \"http://rs.tdwg.org/dwc/terms/country\": null,\r\n  \"http://rs.tdwg.org/dwc/terms/verbatimTaxonRank\": \"species\",\r\n  \"http://rs.tdwg.org/dwc/terms/specificEpithet\": \"sylvaticus\",\r\n  \"http://rs.tdwg.org/dwc/terms/nomenclaturalCode\": \"ICZN\",\r\n  \"http://rs.tdwg.org/dwc/terms/occurrenceID\": \"BE.0000001_20405621\",\r\n  \"http://rs.tdwg.org/dwc/terms/higherGeography\": null\r\n}\r\n```\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/1099162452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]