[{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839169223","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839169223","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839169223,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTE2OTIyMw==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T21:06:14Z","updated_at":"2021-05-11T21:07:34Z","body":"Right now, as we discussed in person, doing `preston (any command) | head -n20` will only print 20 lines, but preston will keep on running. It's easy to see this behavior by setting `--remote`, then seeing that files keep getting downloaded even after the first 20 lines are printed:\r\n\r\n```\r\n$ preston ls --remote https://deeplinker.bio | head\r\n[https://deeplinker.bio/2...210ef59e06b640a3539cb5a] 100.0% of 78 bytes at 0.01 MB/s completed in < 1 minute\r\n[https://deeplinker.bio/c...f936e7be20c29c8e77dee55] 100.0% of 33 MB at 6.15 MB/s completed in < 1 minute\r\n<https://preston.guoda.org> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#SoftwareAgent> .\r\n<https://preston.guoda.org> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Agent> .\r\n<https://preston.guoda.org> <http://purl.org/dc/terms/description> \"Preston is a software program that finds, archives and provides access to biodiversity datasets.\"@en .\r\n<urn:uuid:1d711945-d205-4663-b534-6d706b8b77b6> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> .\r\n<urn:uuid:1d711945-d205-4663-b534-6d706b8b77b6> <http://purl.org/dc/terms/description> \"A crawl event that discovers biodiversity archives.\"@en .\r\n<urn:uuid:1d711945-d205-4663-b534-6d706b8b77b6> <http://www.w3.org/ns/prov#startedAtTime> \"2018-09-04T07:29:11.130Z\"^^<http://www.w3.org/2001/XMLSchema#dateTime> .\r\n<urn:uuid:1d711945-d205-4663-b534-6d706b8b77b6> <http://www.w3.org/ns/prov#wasStartedBy> <https://preston.guoda.org> .\r\n<urn:uuid:0659a54f-b713-4f86-a917-5be166a14110> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Entity> .\r\n<urn:uuid:0659a54f-b713-4f86-a917-5be166a14110> <http://purl.org/dc/terms/description> \"A biodiversity graph archive.\"@en .\r\n<https://idigbio.org> <http://www.w3.org/ns/prov#wasAssociatedWith> <urn:uuid:1d711945-d205-4663-b534-6d706b8b77b6> .\r\n[https://deeplinker.bio/7...fd61a815eee82cdffeab196] 100.0% of 78 bytes at ? MB/s completed in < 1 minute\r\n[https://deeplinker.bio/b...7d97bc5ac01afd7bd9abe5d] 21.9% of 33 MB at 4.88 MB/s ETA: +0 minutes\r\n...\r\n```\r\n\r\nA quick-n-maybe-dirty fix would be to simply set a handler for the `SIGPIPE` signal, e.g.\r\n\r\n```java\r\npublic class Preston {\r\n    public static void main(String[] args) {\r\n        Signal.handle(new Signal(\"PIPE\"), signal -> exit(0));\r\n        // do other stuff\r\n    }\r\n    // ...\r\n}\r\n```\r\n\r\nAlthough, this only works on Unix-like systems. I don't know if there's a similarly simple way of doing this in Windows.\r\n\r\nNote that a `SIGPIPE` will only fire when trying to print *after* the pipe breaks, not *when* it breaks, so preston will keep on doing its thing until it tries to print to `stdout` again.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839169223/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839193687","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839193687","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839193687,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTE5MzY4Nw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T21:36:05Z","updated_at":"2021-05-11T21:36:21Z","body":"Thanks for sharing! \r\n\r\nNote that https://github.com/bio-guoda/preston/blob/2baf81cd12bc76f73f236203d450e95264fdc1fe/src/main/java/bio/guoda/preston/cmd/Cmd.java has a commented section on a similar attempt to have a way to stop processing.\r\n\r\nSome related ideas:\r\n\r\n1. Perhaps we can re-use this shouldStopProcessing by counting the number of produced lines with some ```preston grep --max-lines=10 \"some regex\"``` command. \r\n2. Alternatively, we can check the output writer for their location/type and check printstream     ```public boolean checkError()```  output result. I believe pipes have a special notation that we might be able to detect somehow.  See https://stackoverflow.com/questions/8007995/how-to-identify-a-broken-socket-connection-in-java-immediately .\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839193687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839216378","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839216378","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839216378,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTIxNjM3OA==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T22:05:13Z","updated_at":"2021-05-11T22:10:30Z","body":"> Note that https://github.com/bio-guoda/preston/blob/2baf81cd12bc76f73f236203d450e95264fdc1fe/src/main/java/bio/guoda/preston/cmd/Cmd.java has a commented section on a similar attempt to have a way to stop processing.\r\n\r\nLooks familiar! Any reason why it's commented out?\r\n\r\n> Perhaps we can re-use this shouldStopProcessing by counting the number of produced lines with some `preston grep --max-lines=10 \"some regex\"` command.\r\n\r\nI like this, but because `shouldKeepProcessing` controls the whole process, this has the same intent as doing `preston grep | head -n10` right? We'd still have to use `xargs` when grepping through lots of contents? It couldn't control \"the number of matches shown for each content\" ~~as in the 3rd example (`preston cat hash://sha256/abcdef | xargs -L1 preston match --max-per-contentid=1`), where we'd want preston to skip the rest of the current content and begin grepping the next content~~. Edit: oops, looks like that is using `xargs`... maybe that's a typo\r\n\r\n> I believe pipes have a special notation that we might be able to detect somehow.\r\n\r\nI've only been able to find solutions that check for a broken pipe during a write (I believe `checkError()` checks whether the previous `write()` was successful, rather than whether the output is currently closed), but if this is possible, I think it would be ideal","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839216378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839243552","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839243552","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839243552,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTI0MzU1Mg==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T22:38:49Z","updated_at":"2021-05-11T22:38:49Z","body":"I think you'll have to write to a stream to try and see whether the stream in broken and/or closed. I believe that even the Pipe Signal happens after you try to write to a broken pipe. Can you confirm?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839243552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839258487","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839258487","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839258487,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTI1ODQ4Nw==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T22:56:23Z","updated_at":"2021-05-11T22:56:23Z","body":"> I believe that even the Pipe Signal happens after you try to write to a broken pipe. Can you confirm?\r\n\r\nThatâ€™s right, I tried the signal handler approach and it worked nicely for `preston ls | head`","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839258487/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839259810","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839259810","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839259810,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTI1OTgxMA==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T22:58:36Z","updated_at":"2021-05-11T22:58:36Z","body":"Ok, so that approach would be similar to checking the checkError() after writing to the stream correct?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839259810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839288513","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839288513","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839288513,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTI4ODUxMw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T23:41:15Z","updated_at":"2021-05-11T23:41:15Z","body":">Any reason why it's commented out?\r\n\r\nYes, the reason why it was commented out is because some jvm version deliberately crashed/puked on it. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839288513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839385962","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-839385962","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":839385962,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTM4NTk2Mg==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-12T02:28:47Z","updated_at":"2021-05-12T02:28:47Z","body":"> Ok, so that approach would be similar to checking the checkError() after writing to the stream correct?\r\n\r\nIt should be, in the case of broken pipes. There must be other errors that can cause `checkError()` to be true though, but I doubt it matters much.\r\n\r\n> Yes, the reason why it was commented out is because some jvm version deliberately crashed/puked on it.\r\n\r\nYikes! Is it because the signal handling stuff is in a sun library? Maybe it doesn't play nice with all jvms?\r\n\r\nAnyway, that's too bad. If we want to go the `checkError()` route instead, my initial thoughts would be to either 1) change the `on` function for `StatementListener`s to return a boolean indicating success, or 2) allow the `on` function to throw an exception. Then `StatementEmitter`s can decide how to proceed when a listener has issues. These kinds of changes would touch a lot of code though... maybe there's a better way?","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/839385962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840144822","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-840144822","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":840144822,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDE0NDgyMg==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-12T22:54:07Z","updated_at":"2021-05-12T22:54:07Z","body":"preston now happily stops processing on pipe breaks. Using the preston amazon dataset (latest log `hash://sha256/1aa34112ade084ccc8707388fbc329dcb8fae5f895cb266e3ad943f7495740b3`)\r\n\r\n```\r\n$ time preston ls | preston grep | head -n3\r\n<urn:uuid:0bd260d7-a83c-4a7d-b7b3-89cba3b85fdf> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:0bd260d7-a83c-4a7d-b7b3-89cba3b85fdf> .\r\n<urn:uuid:0bd260d7-a83c-4a7d-b7b3-89cba3b85fdf> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:0bd260d7-a83c-4a7d-b7b3-89cba3b85fdf> .\r\n<urn:uuid:0bd260d7-a83c-4a7d-b7b3-89cba3b85fdf> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:0bd260d7-a83c-4a7d-b7b3-89cba3b85fdf> .\r\n\r\nreal    0m0.802s\r\nuser    0m1.609s\r\nsys     0m0.531s\r\n```\r\n\r\nCompare to how long the procedure took before broken pipe detection:\r\n\r\n```\r\n$ time preston ls | preston grep | head -n3\r\n<urn:uuid:4071362d-b422-478a-b5ea-8c8aa5a72c17> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:4071362d-b422-478a-b5ea-8c8aa5a72c17> .\r\n<urn:uuid:4071362d-b422-478a-b5ea-8c8aa5a72c17> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:4071362d-b422-478a-b5ea-8c8aa5a72c17> .\r\n<urn:uuid:4071362d-b422-478a-b5ea-8c8aa5a72c17> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:4071362d-b422-478a-b5ea-8c8aa5a72c17> .\r\n\r\nreal    0m3.152s\r\nuser    0m5.859s\r\nsys     0m1.313s\r\n```","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840144822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840151441","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-840151441","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":840151441,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDE1MTQ0MQ==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-12T23:11:09Z","updated_at":"2021-05-12T23:11:09Z","body":"`preston grep` also accepts a `max-per-content=n` option that stops matching after exactly `n` matches (whereas doing `preston grep | head -n3` would stop matching after 4 matches instead of 3 because we don't realize the pipe is broken until the next attempt to print to stdout).\r\n\r\nWithout setting `max-per-content`:\r\n\r\n```\r\n$ preston ls | preston grep | head\r\n<urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b1063-1137> <http://www.w3.org/ns/prov#value> \"http://www.freshwaterbiodiversity.eu/metadb/bf_mdb_view.php?entryID=BFE_105\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b2020-2060> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4243.2.7\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b2556-2596> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4425.3.1\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b4934-4974> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4236.2.2\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b7224-7266> <http://www.w3.org/ns/prov#value> \"http://dx.doi.org/10.11646/zootaxa.3669.2.5\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b8860-8902> <http://www.w3.org/ns/prov#value> \"http://dx.doi.org/10.3897/zookeys.740.14640\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b8910-8952> <http://www.w3.org/ns/prov#value> \"http://dx.doi.org/10.3897/zookeys.740.14640\" <urn:uuid:63876253-59c5-40af-a940-4b428f7c3881> .\r\n```\r\n\r\nWith `max-per-content=2`\r\n\r\n```\r\n$ preston ls | preston grep --max-per-content=2 | head\r\n<urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> .\r\n<urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> .\r\n<urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b1063-1137> <http://www.w3.org/ns/prov#value> \"http://www.freshwaterbiodiversity.eu/metadb/bf_mdb_view.php?entryID=BFE_105\" <urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b2020-2060> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4243.2.7\" <urn:uuid:e2ef5608-92d3-4bc0-bbe5-4a4d83b91d0e> .\r\n<urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> .\r\n<urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> <http://www.w3.org/ns/prov#used> <hash://sha256/f6a9c77382d8e4efa15236d5ef002d8ba97ecad4b6f1a8dc044053113fee8d25> <urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> .\r\n<urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> .\r\n<cut:hash://sha256/f6a9c77382d8e4efa15236d5ef002d8ba97ecad4b6f1a8dc044053113fee8d25!/b571-599> <http://www.w3.org/ns/prov#value> \"http://atrium.andesamazon.org\" <urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> .\r\n<cut:hash://sha256/f6a9c77382d8e4efa15236d5ef002d8ba97ecad4b6f1a8dc044053113fee8d25!/b718-748> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.15468/uaq7do\" <urn:uuid:b57cdd19-e482-4191-8d75-bf152aec784a> .\r\n```","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840151441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840671595","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-840671595","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":840671595,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDY3MTU5NQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-13T16:20:52Z","updated_at":"2021-05-13T16:20:52Z","body":"@mielliott thanks for making the improvements to help for more efficient processing of preston provenance logs and downstream operations.\r\n\r\nI was able to reproduce:\r\n```\r\n$ time preston ls | preston grep | head -n3\r\n<urn:uuid:781746b1-0b7e-476c-a3ce-7d6bd50e069d> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:781746b1-0b7e-476c-a3ce-7d6bd50e069d> .\r\n<urn:uuid:781746b1-0b7e-476c-a3ce-7d6bd50e069d> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:781746b1-0b7e-476c-a3ce-7d6bd50e069d> .\r\n<urn:uuid:781746b1-0b7e-476c-a3ce-7d6bd50e069d> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:781746b1-0b7e-476c-a3ce-7d6bd50e069d> .\r\n\r\nreal\t0m1.361s\r\nuser\t0m3.814s\r\nsys\t0m0.152s\r\n```\r\n\r\nand \r\n\r\n```\r\n$ preston ls | preston grep | head\r\n<urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b1063-1137> <http://www.w3.org/ns/prov#value> \"http://www.freshwaterbiodiversity.eu/metadb/bf_mdb_view.php?entryID=BFE_105\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b2020-2060> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4243.2.7\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b2556-2596> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4425.3.1\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b4934-4974> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4236.2.2\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b7224-7266> <http://www.w3.org/ns/prov#value> \"http://dx.doi.org/10.11646/zootaxa.3669.2.5\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b8860-8902> <http://www.w3.org/ns/prov#value> \"http://dx.doi.org/10.3897/zookeys.740.14640\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b8910-8952> <http://www.w3.org/ns/prov#value> \"http://dx.doi.org/10.3897/zookeys.740.14640\" <urn:uuid:b8c46a9e-8433-47d5-a7ad-76069e21174c> .\r\n```\r\n\r\nand \r\n\r\n```\r\n$ preston ls | preston grep --max-per-content=2 | head\r\n<urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> .\r\n<urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> <http://www.w3.org/ns/prov#used> <hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5> <urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> .\r\n<urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b1063-1137> <http://www.w3.org/ns/prov#value> \"http://www.freshwaterbiodiversity.eu/metadb/bf_mdb_view.php?entryID=BFE_105\" <urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> .\r\n<cut:hash://sha256/6d86c332b045e74fe4410f79655a1f47596808c057f30779b9584dba38fa25d5!/b2020-2060> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.11646/zootaxa.4243.2.7\" <urn:uuid:a13b33c9-4b75-44d2-bbe9-60ab565c534b> .\r\n<urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/ns/prov#Activity> <urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> .\r\n<urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> <http://www.w3.org/ns/prov#used> <hash://sha256/f6a9c77382d8e4efa15236d5ef002d8ba97ecad4b6f1a8dc044053113fee8d25> <urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> .\r\n<urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> <http://purl.org/dc/terms/description> \"An activity that finds the locations of text matching the regular expression '(?:https?|ftp|file)://[-a-zA-Z0-9+&@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&@#/%=~_|]' inside any encountered content (e.g., hash://sha256/... identifiers).\"@en <urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> .\r\n<cut:hash://sha256/f6a9c77382d8e4efa15236d5ef002d8ba97ecad4b6f1a8dc044053113fee8d25!/b571-599> <http://www.w3.org/ns/prov#value> \"http://atrium.andesamazon.org\" <urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> .\r\n<cut:hash://sha256/f6a9c77382d8e4efa15236d5ef002d8ba97ecad4b6f1a8dc044053113fee8d25!/b718-748> <http://www.w3.org/ns/prov#value> \"https://doi.org/10.15468/uaq7do\" <urn:uuid:1f773f44-9600-43d3-8bb1-029cbf42f236> .\r\n\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840671595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840673811","html_url":"https://github.com/bio-guoda/preston/issues/89#issuecomment-840673811","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/89","id":840673811,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDY3MzgxMQ==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-13T16:24:32Z","updated_at":"2021-05-13T16:24:32Z","body":"@jhpoelen Thanks for reproducing!","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/840673811/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]