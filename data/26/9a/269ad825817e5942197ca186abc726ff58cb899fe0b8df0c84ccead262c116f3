[{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/700315009","html_url":"https://github.com/bio-guoda/preston/issues/83#issuecomment-700315009","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/83","id":700315009,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDMxNTAwOQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-28T22:22:21Z","updated_at":"2020-09-28T22:22:21Z","body":"Root cause is likely https://github.com/bio-guoda/preston/blob/8a44764fc80b732f831701e0451d7e25b5edca58/src/main/java/bio/guoda/preston/process/TextMatcher.java#L69 . Statement are cached in memory to be submitted in one big batch as a new activity. Sounds like we need some batching mechanism. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/700315009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/700353693","html_url":"https://github.com/bio-guoda/preston/issues/83#issuecomment-700353693","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/83","id":700353693,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDM1MzY5Mw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T00:30:31Z","updated_at":"2020-09-29T00:31:14Z","body":"@mielliott I took a stab as solving this issue by introducing batching of statements in the TextMatcher. I also removed the functionality to let the CmdMatcher automatically append to the provenance log. If output of the matcher is to be added to the provenance log, the output of ```preston match``` can be piped into ```preston process``` . \r\n\r\nAfter these changes, I was able to run:\r\n\r\n```\r\n$ preston cat \"hash://sha256/022661ff64d57492be767623b87174f46354b6665abbbf962512ebb1519031bd\" --remote https://deeplinker.org > /dev/null\r\n$ time echo \"<https://example.org> <http://purl.org/pav/hasVersion> <hash://sha256/022661ff64d57492be767623b87174f46354b6665abbbf962512ebb1519031bd> .\" | preston match | pv -l | wc -l\r\n14.2M 0:05:14 [45.3k/s] [                             <=>                                                                             ]\r\n14229035\r\n\r\nreal 5m14.191s\r\nuser 5m51.775s\r\nsys 1m52.327s\r\n```\r\n\r\nto extract about 14.2M urls from a 100MB zip file ~ 1.5GB uncompressed.\r\n\r\nPlease review.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/700353693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/700893752","html_url":"https://github.com/bio-guoda/preston/issues/83#issuecomment-700893752","issue_url":"https://api.github.com/repos/bio-guoda/preston/issues/83","id":700893752,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDg5Mzc1Mg==","user":{"login":"mielliott","id":9602463,"node_id":"MDQ6VXNlcjk2MDI0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9602463?v=4","gravatar_id":"","url":"https://api.github.com/users/mielliott","html_url":"https://github.com/mielliott","followers_url":"https://api.github.com/users/mielliott/followers","following_url":"https://api.github.com/users/mielliott/following{/other_user}","gists_url":"https://api.github.com/users/mielliott/gists{/gist_id}","starred_url":"https://api.github.com/users/mielliott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mielliott/subscriptions","organizations_url":"https://api.github.com/users/mielliott/orgs","repos_url":"https://api.github.com/users/mielliott/repos","events_url":"https://api.github.com/users/mielliott/events{/privacy}","received_events_url":"https://api.github.com/users/mielliott/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T18:18:34Z","updated_at":"2020-09-29T18:18:34Z","body":"Thanks for taking care of this @jhpoelen . Looks like a good solution. I reviewed the code and am closing the issue.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/bio-guoda/preston/issues/comments/700893752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]